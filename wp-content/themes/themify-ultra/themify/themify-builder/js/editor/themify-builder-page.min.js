'use strict';((m,d)=>{let b;window.ThemifyBuilderPage={container:null,layout_lists:null,spinner:null,layouts_loaded:!1,loadCSS(){const a=d.createDocumentFragment();Object.keys(tbBuilderPage.css).forEach(function(c){if(!document.getElementById(c+"-css")){const e=d.createElement("link");e.setAttribute("rel","stylesheet");e.setAttribute("href",tbBuilderPage.css[c]);e.setAttribute("id",c+"-css");a.appendChild(e)}});d.head.appendChild(a)},loadLayoutsList(){m.ajax({type:"POST",url:tbBuilderPage.ajaxurl,
dataType:"json",data:{action:"tb_load_predesigned_layouts",nonce:tbBuilderPage.nonce,src:tbBuilderPage.paths.layouts_index},success(a){b.layouts_loaded=!0;a=JSON.parse(a.data);b.renderLayouts(a);b.spinner.style.display="none"},error(){}})},publishPage(a){return m.ajax({type:"POST",url:tbBuilderPage.ajaxurl,data:{_ajax_nonce:tbBuilderPage.nonce,action:"tb_builder_page_publish",title:a.title,layout:a.layout,parent:a.parent},success(c){c.success?window.location=c.data:(console&&console.log(c),b.hidePanel())},
complete(){b.spinner.style.display="none"}})},renderLayouts(a,c){c={};const e=d.createDocumentFragment();d.createDocumentFragment();const l=b.container.querySelector(".tbbp_search_icon svg"),r=b.container.querySelector(".tbbp_category ul");for(let f=0,t=a.length;f<t;++f){var k=d.createElement("li"),g=d.createElement("div"),h=d.createElement("div");let q=d.createElement("div"),p=d.createElement("img");k.dataset.category=a[f].category;g.className="tbbp_preview";g.dataset.id=a[f].id;g.dataset.slug=a[f].slug;
h.className="tbbp_thumbnail";p.src=a[f].thumbnail;p.alt=a[f].title;p.title=a[f].title;q.className="tbbp_layout_title";q.textContent=a[f].title;h.appendChild(p);g.appendChild(h);g.appendChild(q);void 0!==a[f].url&&(h=d.createElement("a"),h.className="tbbp_preview_link",h.href=a[f].url,h.target="_blank",h.title="Preview",h.appendChild(l.cloneNode(!0)),g.appendChild(h));k.appendChild(g);e.appendChild(k);if(a[f].category){k=String(a[f].category).split(",");for(let n=0,u=k.length;n<u;++n)""!==k[n]&&1!==
c[k[n]]&&(g=d.createElement("li"),g.textContent=k[n],r.appendChild(g),c[k[n]]=1)}}b.layout_lists.appendChild(e)},init(){b.layout_lists.addEventListener("click",function(a){if(a.target.closest("li")){let c;null==(c=b.layout_lists.querySelector(".selected"))||c.classList.remove("selected");a.target.closest("li").classList.add("selected")}});b.container.querySelector(".tbbp_close").addEventListener("click",function(){b.hidePanel()});b.container.querySelector(".tbbp_search_container input").addEventListener("keyup",
function(){let a=this.value.trim(),c=m(b.layout_lists).find("li");""===a?c.show():c.hide().find(".tbbp_layout_title").filter(function(){return(new RegExp(a,"i")).test(m(this).text())}).closest("li").show()});b.container.addEventListener("submit",function(a){const c=b.container.querySelector(".tbbp_title input").value;if(""!==c){a.preventDefault();b.spinner.style.display="block";a=b.layout_lists.querySelector(".selected > div").dataset.slug;var e=b.container.querySelector(".tbbp_parent select").value;
""===a?b.publishPage({title:c,parent:e}):m.get(tbBuilderPage.paths.layout_template.replace("{SLUG}",a),null,null,"text").done(l=>{l=JSON.parse(l);b.publishPage({title:c,parent:e,layout:l})})}});b.container.querySelector(".tbbp_category ul").addEventListener("click",a=>{if("LI"===a.target.tagName){var c=m(b.layout_lists).find("li"),e=a.target.textContent,l=a.target.closest(".tbbp_category").querySelector(".tbbp_category_label");l.blur();l.textContent=e;a.target.classList.contains("all")?c.show():c.hide().filter('[data-category*="'+
e+'"]').show()}})},loadPanel(){return null===b.container?m.ajax({type:"POST",url:tbBuilderPage.ajaxurl,data:{_ajax_nonce:tbBuilderPage.nonce,action:"tb_builder_page"},success(a){let c=d.createElement("div");c.innerHTML=a;b.container=c.firstChild;b.layout_lists=b.container.getElementsByClassName("tbbp_layout_lists")[0];d.body.appendChild(b.container)}}):new Promise(a=>{a()})},showPanel(){b.container.style.display="block"},hidePanel(){b.container.style.display="none"},run(){b=this;b.loadCSS();b.loadPanel().then(function(){b.showPanel();
b.layouts_loaded||b.loadLayoutsList();b.init();b.container.querySelector("#title").focus()})}}})(jQuery,document);
